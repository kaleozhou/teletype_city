# 《终端·回响》——纯终端网络游戏设计方案 v1

> 关键词：Telnet / 纯文本 / ANSI 颜色 / 房间式 MUD / 回合制 / 轻社交 / 低门槛高沉浸

---

## 1. 一句话概念 & 卖点
- **一句话**：在一座复古码头城里，以键盘敲下每一道命令，结识远方的旅人、完成小小的冒险，听见电传机与灯塔在文本中回响。
- **核心卖点**：
  1) 零门槛接入（`telnet host 2323`），**开箱即玩**；
  2) **原味文本交互** + 现代化体验（UTF-8、可读性、辅助功能）；
  3) **五分钟上手**、一小时打通主线，长期靠社交与日常事件留存；
  4) **作者型内容友好**：世界由简单 YAML/JSON 扩展，热加载。

---

## 2. 玩家体验（First 5 Minutes）
1. 连接即见 ASCII 横幅 + MOTD，提示 `LOGIN <昵称>`。
2. 系统教一条命令就推进一小步（渐进式帮助）：`LOOK` → `SAY` → `GO N`。
3. 第一任务：在“老码头”找到遗落的电报纸带，交给“电传机房”的技师，获得新手称号【报童】与 20 铆钉（货币）。
4. 进入“集市”触发公共聊天提示，认识其他玩家，学习 `WHO`、`TELL`。

---

## 3. 世界观 & 主题
- **时代质感**：BBS 与港口城市的混搭；灯塔、码头、机房、老城区、地下水道。
- **叙事气质**：温暖、克制、略带怀旧的工业浪漫。
- **世界分区**（首发 5 区）：
  - 【老码头】玩家出生点，任务与指引；
  - 【电传机房】新手主线、中级制作（改装装置、解码）；
  - 【集市】交易与社交，公告板、拍卖；
  - 【暗巷/旧城区】轻微危机、跑腿、战斗入门；
  - 【灯塔下】整点世界事件、稀有鱼群与海风传说。

---

## 4. 核心循环（Core Loop）
**探索 → 聊天 → 任务/战斗 → 获得物品/称号 → 解锁新区域/小功能 → 回到社交**。
- 节奏：**5–10Hz 服务器 tick**（100–200ms），玩家输入随时响应，战斗为**回合制**。

---

## 5. 系统设计
### 5.1 角色与属性
- `name`（昵称，唯一）、`title`（称号）、`HP`、`EP`（精力）、`STR/AGI/INT/CHA`（轻量四维）。
- 成长：通过任务与称号解锁被动（如【报童】→ 邮件投递加速）。

### 5.2 背包与装备
- 物品分：材料、消耗品、工具、饰品；
- 背包以格数限制（前期 12 格），可扩展（帆布包）。

### 5.3 经济
- 货币：**铆钉（Rivets）**，通过任务、收集、拍卖获得。
- 集市 NPC 固定收购价 + 玩家之间 **以物换物** 与简易拍卖（文本倒计时）。

### 5.4 任务系统
- 类型：主线（世界观）、看板日常（可循环）、探索触发（进房间触发）、事件（整点）。
- 描述力求短小：**3~5 行文本** + 1 条指令提醒。

### 5.5 战斗（可选开关，默认开启）
- **回合制**：`ATTACK <目标>` → 服务器计算命中/伤害 → 文本反馈；
- **冷却**：普攻 2 秒；技能 5–12 秒；
- **仇恨**：优先攻击最近/仇恨最高的玩家；
- **失败成本**：HP 清零回到出生点，损失少量铆钉（不掉装）。

### 5.6 社交
- 房间聊天（默认）、全服频道 `JOIN #global`、私聊 `TELL <name>`；
- 表情：`EMOTE <动作>` 以第三人称广播；
- 留言板：`BOARD` 查看/发帖；邮件 `MAIL`。

### 5.7 管理与安全
- 管理员命令：`/announce`、`/mute`、`/kick`、`/ban`、`/teleport`；
- 安全：指令长度限制、频率限制、心跳；可选 `stunnel/ssh` 做 TLS 包裹。

---

## 6. 命令设计（玩家侧）
```
# 导航与观察
LOOK                  # 查看当前房间
GO N|S|E|W            # 朝方向移动
MAP                   # 简图（ASCII 罗盘）

# 社交
SAY <text>            # 房间内发言
WHO                   # 在线列表
TELL <name> <text>    # 私聊
JOIN #channel         # 加入频道
LEAVE #channel        # 退出频道
EMOTE <text>          # 第三人称动作

# 角色与物品
INV                   # 背包
USE <item>            # 使用
GIVE <name> <item>    # 给予
EQUIP <item>          # 装备
STATS                 # 状态

# 任务
QUESTS                # 列出任务
TRACK <id>            # 追踪任务
TURNIN <id>           # 交付任务

# 战斗（可选模块）
ATTACK <target>
SKILL <name> <target>
FLEE

# 系统
HELP [topic]
QUIT
```
- 别名示例：`N`=`GO N`，`SAY` 的别名为 `"`（双引号开头的行即发言）。

---

## 7. 文本协议（Server ↔ Client）
### 7.1 连接与登录
- 客户端：`LOGIN <name> <password?>`（可选密码，MVP 为免密）
- 服务端：
```
OK <message>
ERR <reason>
SYS <notice>         # 系统/提示/公告（青色）
ROOM <title>
DESC <multiline text>
YOU POS <x> <y>      # 自身状态
YOU HP <cur>/<max>
SEEN <name> <event>  # 某玩家进入/离开/发言/动作
LIST <name...>
ITEM <serialized item json>
QUEST <serialized quest json>
```
- 统一 **一行一消息**，\n 结尾；多行文本用多条 `DESC` 发送；颜色用 ANSI 转义。

### 7.2 Tick 与广播
- **Tick**：100–200ms；战斗与 AI 在 tick 中推进；
- **广播**：按房间/频道范围发送；服务端负责节流（同帧合并）。

---

## 8. 服务器架构（技术）
```
app/
  server.py          # TCP 接入（asyncio/tokio）
  protocol.py        # 编码/解码 & 帧合并
  commands.py        # 命令解析与路由（策略表/注册器）
  world/
    rooms.py         # 房间表/搜索/出入口
    entities.py      # 玩家/NPC/物品（轻量 ECS）
    combat.py        # 回合制计算
    quests.py        # 任务流
  systems/
    chat.py          # 聊天/频道
    board.py         # 留言板
    mail.py          # 邮件
  data/
    rooms.yml        # 世界数据
    npcs.yml
    items.yml
    quests.yml
  persist/
    storage.py       # JSON/SQLite 存档层
  admin/
    gm.py            # 管理命令
```
- **语言建议**：Python（`asyncio`）或 Rust（`tokio`）。MVP 用 Python 便于快速迭代。
- **数据存储**：
  - 开发期：JSON/SQLite；
  - 线上：SQLite → PostgreSQL（可选）。
- **日志**：文本行日志，字段：`ts, level, session, player, action, args, latency`。

---

## 9. 数据格式（示例）
### 9.1 房间（YAML）
```yaml
# data/rooms.yml
- id: dock
  title: 老码头
  desc: |-
    潮湿的木板甲板，旧时代的钟声依稀可闻。
  pos: [0, 0]
  exits: {N: lighthouse, E: teletype, S: market, W: alley}
  on_enter:
    - say: "海风裹挟着盐味，远处传来汽笛声。"

- id: teletype
  title: 电传机房
  desc: |-
    噼啪作响的继电器，让人想起 BBS 的岁月。
  pos: [1, 0]
  exits: {W: dock}
  npcs: [mechanic]
```

### 9.2 NPC（YAML）
```yaml
# data/npcs.yml
- id: mechanic
  name: 机房技师
  dialog:
    greet: "有纸带就拿来，我给你解码。"
  trade:
    buy: {scrap: 3}
    sell: {paper_tape: 5}
  quests: [q_intro_tape]
```

### 9.3 任务（YAML）
```yaml
# data/quests.yml
- id: q_intro_tape
  name: 初识电报
  desc: 找到遗落的纸带，带去电传机房的技师处。
  steps:
    - collect: {item: paper_tape, count: 1}
    - talk: {npc: mechanic}
  reward:
    items: [{id: pouch_small, count: 1}]
    money: 20
    title: 报童
```

### 9.4 物品（YAML）
```yaml
# data/items.yml
- id: paper_tape
  name: 纸带
  type: material
  desc: 打孔纸带，上面是无法辨识的讯息。

- id: pouch_small
  name: 帆布小袋
  type: bag
  slots: 6
```

---

## 10. 可访问性与兼容
- **编码**：UTF-8；提供 `ASCII_ONLY` 模式（去除全角/彩色符号）。
- **颜色**：默认 16 色，自动降级；提供 `COLOR OFF` 命令。
- **屏幕阅读器**：前缀化消息种类（`ROOM/SEEN/ERR`），避免混排。

---

## 11. 运营细节
- **MOTD**：每日一更文本；
- **整点事件**：`00:00` 灯塔鸣笛，掉落稀有鱼群；
- **节日彩蛋**：中秋/春节限定房间与称号；
- **社区规范**：简明 10 条，`/report <name> <reason>`。

---

## 12. MVP 范围（两周）
**功能**：登录/登出、房间移动、`LOOK/GO/SAY/WHO/TELL`、背包、简易任务 3 条、拍卖雏形、公告板、管理员广播。
**内容**：首发 20 个房间、5 个 NPC、15 件物品、1 条主线 + 6 条看板任务。
**技术**：Python `asyncio` 服务器、YAML 数据、JSON 存档、`systemd` 部署脚本、基础监控（进程存活/在线数）。

---

## 13. 路线图
- **v0.1（D0–D7）**：网络/命令/世界加载/聊天/任务框架；
- **v0.2（D8–D14）**：背包/交易/拍卖/公告板/整点事件；
- **v0.3**：回合制战斗 + 简易 AI；
- **v0.4**：邮件系统、公会、排行榜；
- **v0.5**：热加载/在线编辑器（GM 工具）；
- **v1.0**：内容扩容至 80+ 房间、周常活动与节日彩蛋。

---

## 14. 关键 KPI（上线后）
- D1 留存 ≥ 35%，D7 留存 ≥ 12%；
- 同时在线峰值 ≥ 60；
- 日均命令数/DAU ≥ 200；
- 新手 5 分钟完成率 ≥ 75%。

---

## 15. 质量与测试
- **单元**：命令解析、移动/碰撞、道具增删、任务条件判断；
- **集成**：并发 200 连接、指令洪泛防护；
- **回归**：数据热加载不丢状态；
- **脚本**：`loadtest.py` 模拟 100 虚拟玩家巡游与聊天。

---

## 16. 示例：上线文案 & ASCII 横幅
```
\x1b[36m  ____  _   _  ____    ____                  _           _
 |  _ \| \ | |/ ___|  / ___|_ __ ___  __ _  __| | ___  ___| |
 | |_) |  \| | |  _  | |  _| '__/ _ \/ _` |/ _` |/ _ \/ __| |
 |  __/| |\  | |_| | | |_| | | |  __/ (_| | (_| |  __/\__ \_|
 |_|   |_| \_|\____|  \____|_|  \___|\__,_|\__,_|\___||___(_)
\x1b[0m
```
MOTD：欢迎来到【终端·回响】，输入 `LOGIN 你的昵称` 开始。新手任务：在老码头寻找【纸带】并带到【电传机房】！

---

## 17. 示例：Telnet 体验脚本（节选）
```
> telnet your.host 2323
SYS 欢迎来到 终端·回响 (Telnet MUD)。输入：LOGIN <昵称>
LOGIN 海风
OK 登录为 海风
ROOM 老码头
DESC 潮湿的木板甲板，旧时代的钟声依稀可闻。
SAY 大家好
OK 你说：大家好
SEEN 远客: 大家好，来集市吗？
GO E
ROOM 电传机房
DESC 噼啪作响的继电器，让人想起 BBS 的岁月。
SEEN 机房技师 说：有纸带就拿来，我给你解码。
```

---

## 18. 部署建议
- **端口**：TCP 2323；可选 `stunnel` 443 端口转发；
- **进程**：`systemd` 管理、自动重启；
- **备份**：每日导出 JSON 存档；
- **监控**：在线人数、CPU/内存、每分钟命令数、错误率；
- **灰度**：预备 `staging` 实例，数据分离。

---

## 19. 许可与社区
- 开源可选 MIT/Apache-2.0；
- 玩家守则十条（文明聊天、尊重创作、不剧透主线…）。

---

### 附：可扩展方向（选做）
- **可选 curses 客户端**：顶部房间名、左侧聊天、右侧在线、底部输入，仍保持协议兼容；
- **脚本化事件**：Cron 风格触发器（每晚 22:00 水道巡逻）；
- **无障碍增强**：`SPEAK ON` 调用屏幕阅读器（平台相关）。

